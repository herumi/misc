# C++ Numerics WOrk In Progress

- [P1889 C++ Numerics Work In Progress](https://github.com/cplusplus/papers/issues/638)
- [P1889R1](https://wg21.link/p1889r1)

# εγ®ε¤Έεβ¤εγ³

- ιθ¶ρωΐεΆ°εαεα¨θΚ²ιΰ¤εβΔι°΅ινΠεΆ­λι±εα†
- ραΏεαΒε£ιεβΈεΆ¬εα¨ε¤¬εγΌεγΐε¦ΎεγΚε¦―εγΌεα¨θΊΈεβΆε£ςθΌ°θΈ¬ιο―ογ½εα§ιθ¶κΐ΅εα§εαΊε£λεβ°ε΅ζεα«εαε£λ
- εβ¨εγεβΆεβΉεβΔλΆΑεαΒεΆ΅εβ΄ι­Με΅χεαήε£κεαε£λ
- εγ©εγ³εβΏεβ¤εγ εβ¨εγ©εγΌεβ°ε£κεα―εβ³εγ³εγΒε¤¦εγ«εβΏεβ¤εγ εβ¨εγ©εγΌ
- ικΉνξ®εΆ°εβ°ε΅διθΪθΨ΅ιΰ¤εβ°ε£κεα―κ°²ηεαιθΪθΨ΅ιΰ¤

# ιώ¶εΆ°ιθ¬λ΅
- ρύιΣδεα§ιπΈε΅ψεβµεβ¤εβΊ
- ιλΚιΣδεα§εβεγΌεγΐε¦ΎεγΚε¦―εγΌεβΔλΆΑεαΒε£λ

# λσΊζ½

## ξ°Ξκ΅ΖθΌΘι®—
- `-` ; neg
- `+` ; add
- `-` ; sub
- `*` ; mul
- rdiv ; divide with rounding
- pdiv ; divide with promotion
- quorem ; quotient and remainder
- mod ; modulo
- rem ; remainder; different sign matching rules

## εβΉεβ±εγΌεγ«εγ»εβ·εγΚε¥θ
- su ; static scale up
- ssd ; static scale down with rounding
- dsu ; dynamic scale up
- dsd ; dynamic scale down with rounding
- lsh ; left shift
- ash ; arithmetic right shift
- rsh ; logical right shift
- rtl ; rotate left
- rtr ; rotate right

## ιπ°θ―π
- add2 ; add with two addends
- sub2 ; subtract with two subtrahends
- lshadd ; left shift and add
- lshsub ; left shift and sub
- muladd ; multiply and add
- mulsub ; multiply and subtract
- muladd2 ; multiply and add with two addends
- mulsub2 ; multiply and subtract with two subtrahends

## εγΖε¥γεγ°θΌΘι®—
- not ; 1γΰΡΤ complement
- and ; and
- xor ; exclusive or
- ior ; inclusive or
- dif ; difference (a& ~ b)

# εγάε¤Ήεγ³εα®λκ½π³΅εγ¬εβ¤εγ¤

## εβεγΌεγΐε¦ΎεγΚε¦―εγΌ

### εβεγΌεγΐε¦ΎεγΚε¦―εγΌμ¦Ψη®Ό
λθ»εβ΄η€¤εα
- trueεαεβ²ε¤¬εγΌεγΐε¦ΎεγΚε¦―εγΌ
  - εγΪε¤¦εγ³εβΏεα―θΏΏεβΎε£μεαεα„
- falseεαεβ²ε¤¬εγΌεγΐε¦ΎεγΚε¦―εγΌεα§εα―εαεα„
  - ξ·ΐθΫόεαΈε¥ύεβ¤εγ³εβΏιε°εΆ­θ½£ιε¥εαΚε£μεβ‹

```
constexpr bool overflow_cvt(C* result, T value);
constexpr bool overflow_neg(T* result, T value);
constexpr bool overflow_lsh(T* product, T multiplicand, int count);
constexpr bool overflow_add(T* summand, T augend, T addend);
constexpr bool overflow_sub(T* difference, T minuend, T subtrahend);
constexpr bool overflow_mul(T* product, T multiplicand, T multiplier);
```
ιώµ¤εα¨Tεα―θ½»λδΎεΆ°λυ΄λυ°ιώ‹

### εβεγΌεγΐε¦ΎεγΚε¦―εγΌεγΎε¦µεγ²ε¦¬εγ³εβ°
```
enum class overflow {
  impossible, undefined, abort, exception,
  special,
  saturate, modulo_shifted
};
```
- overflow, convert, limitεαεα©εα®ρφΆλυ°κ°ΤιΎ©
- θΊ»εα«κ°ήθΚ²ντ¨ρΰ”

### θΊΈεβΆθΕνθΏ
### θΊΈεβΆθΕνθΏΨεΆεβεγΌεγΐε¦ΎεγΚε¦―εγΌεα®ιπΈθΡβιη¦νπ†

## εγ€εγΜε¦­εγ―εγΌεγ²θΕνθΏ
CPUεα®εγ―εγΌεγ²ε¤·εβ¤εβΊεα®2ιΰΊε¤·εβ¤εβΊεα®μΎΘι®—

- S ; ξ®¦ιο·εα¤εαΊθΚ¶λυ°
- U ; ξ®¦ιο·νδ΅εαΞθΚ¶λυ°
- DS ; Sεα®2ιΰΊεΆ°εβµεβ¤εβΊεα®λυ΄λυ°
- DU ; Uεα®2ιΰΊεΆ°εβµεβ¤εβΊεα®λυ΄λυ°

Sεβ§¶εα¨DS, DUεα®νϋΈθΌΔη¤²θ½ϋ
```
constexpr S split_upper(DS value);
constexpr U split_lower(DS value);
constexpr DS wide_build(S upper, U lower);
constexpr U split_upper(DU value);
constexpr U split_lower(DU value);
constexpr DU wide_build(U upper, U lower);
```

μΎΘι®ΞεΆ°θΊ€ργ¨
```
constexpr DS wide_lsh(S multiplicand, int count);
constexpr DS wide_add(S augend, S addend);
constexpr DS wide_sub(S minuend, S subtrahend);
constexpr DS wide_mul(S multiplicand, S multiplier);
...
```

# εγάε¤Ήεγ³λλ΅κΎµεγ¬εβ¤εγ¤

```
constexpr U unsigned_subarray_addin_word(U* multiplicand, int length, U addend);
```
- addendεβΔλΚΉεαΙΝengthεα®multiplicandεα«πΈ³εα™
- λθ»εβ΄η€¤εα―ξ·ΐθΫόεα®εβ­εγ£εγεγΌ

```
constexpr U unsigned_subarray_add_word(U* summand, const U* augend, int length, U addend);
```
- addendεβΔλΚΉεαΙΝengthεα®augendεα«πΈ³εαΞεΆ¨ρυ·εαΙΝengthεα®summandεα«λϋΈεαΊκΎΌεβ€
- λθ»εβ΄η€¤εα―ξ·ΐθΫόεα®εβ­εγ£εγεγΌ

```
constexpr U unsigned_subarray_mulin_word(U* product, int length, U multiplier);
```
- ρυ·εαΙΝengthεα®productεα«multiplierεβΔθ»ϋεαΒε£λ
- λθ»εβ΄η€¤εα―ξ·ΐθΫόεα®εβ­εγ£εγεγΌεβΆεβ¦εγ°ε΅υεβΈεΆ΅εβ¤εΆ°

```
constexpr U unsigned_subarray_mul_word(U* product, U* multiplicand, int length, U multiplier);
```
- ρυ·εαΙΝengthεα®multiplicandεα«multiplierεβΔθΦΊεαΒεΆ¨ξ·ΐθΫόεβΔλΚΉεαΙΝengthεα®productεα«ιε¥εβΈε£λ
- λθ»εβ΄η€¤εα―ξ·ΐθΫόεα®εβ­εγ£εγεγΌεβΆεβ¦εγ°ε΅υεβΈεΆ΅εβ¤εΆ°

```
constexpr U unsigned_subarray_accmul_word(U* accumulator, U* multiplicand, int length, U multiplier);
```
- ρυ·εαΙΝengthεα®multiplicandεα«multiplierεβΔθΦΊεαΒεΆ¨ρυ·εαΙΝengthεα®accumulatorεα«πΈ³εαΞεΆ΅εβ¤εΆ°
- λθ»εβ΄η€¤εα―ξ·ΐθΫόεα®εβ­εγ£εγεγΌεβΆεβ¦εγ°ε΅υεβΈεΆ΅εβ¤εΆ°

# εγ―εβ¤εγ²θΚ¶λυ°

`<wide_integer>`


```
template<size_t Bits, typename S> class wide_integer;

template <size_t Bits>
using wide_int = wide_integer<Bits, signed>;
template <size_t Bits>
using wide_uint = wide_integer<Bits, unsigned>;
```
- ξ°Ξκ΅ΖθΌΘι®Ξη­ΐε¦½π­ΜιΏζμΎΘι®ΞεΆ¬εα©εα®εβεγΌεγΐε¦Ύεγ­εγΌεγ²ε΅δεβΊε΅δεβ
- to_string, to_chars, from_charsεαεα©
- _int128, _uint512εαεα©εα®literals

θΐ‹

```
using int128_t = wide_int<128>;
constexpr int128_t c = std::numeric_limits<int128_t>::min();
static_assert(c == 0x80000000000000000000000000000000_uint128);
int256_t a = 13;
a += 0xFF;
a *= 2.0;
a -= 12_int128;
assert(a > 0);
```

# λό²ιΏζλυ°
`<rational>`

- float, doubleεβ§Κntegerεαεα©εα¶ε£ιεα®εβ³εγ³εβΉεγ°ε¦«εβ―εβΏ
- ξ°Ξκ΅ΖθΌΘι®—
- numer() ; ιθ¬η­
- denom() ; ιθ¬θ―

# εγΒε¦«εγ΅εγΌεβΏεβ¨εγεβΆεβΉ
εγάε¤Ήεγ³εα«θΐΪη­Πε΅χεαεα¨ιµ¨εΆΑπΐΌεαΏεα®ιώ¶εΆ°εβ¨εγεβΆεβΉεβΔθ½πθΐ›

θΐ‹
- `template<int bits>using fast_2int` ; κ²ΒεΆ¬εαΎεΆεβ£ΓitsεβΔε£βεα¤ξ·¨εΆΑπΐΌεαΏεα®ξ®¦ιο·εα¤εαΊθΚ¶λυ°εα§θΊ€νυρΰήε΅διώ‹
- `template<int bits> using fast_2ieeefloat` ; κ²ΒεΆ¬εαΎεΆεβ£ΓitsεγΖε¥γεγ°ε£ςλμΆεΆ¦ξ·¨εΆΑπΐΌεαΏεα®IEEEμ·®ιλΚη°ΎθΚ²νβΉλυ°εα§θΊ€νυρΰήε΅διώ‹

# ιθ¶ρωΐι¨£εαΞεΆ°ιώ‹

- `integer_data_proxy` ; `integer`ιώ¶εΆ°ιζλ¦π£¨νοΎεα§θΏΏεβΎε£μεβ‹
  - ρεΊη―χεα®εβΆεβ―εβ»εβΉ, size, capacity, reserver, sfhink_to_fitεαεα©εβΔθ·αεα¤
- `bits` ; ιθ¶ρωΐι¨£εαΞεΆ°bitπ£¨νοΎεα®ρϋ¬ηΏθεβΔθ²³εα¬ε¤±εγ©εβΉ
  - bitwiseεαμΎΘι®ΞεΆ¬εα©εβΔθ·αεα¤
- `integer` ; ιθ¶ρωΐι¨£εαΞεΆ°λυ΄λυ°εβΔθ²³εα¬ε¤±εγ©εβΉ
  - ξ°Ξκ΅ΖθΌΘι®—
  - pow, mod, mulmod, powmodεαεα©εα®modμΎΘι®—
